# Developing business logic with event sourcing

## Pattern: Event sourcing

    Persist an aggregate as a sequence of domain events that represent state changes.
    See http://microservices.io/patterns/data/event-sourcing.html.

Event sourcing is an event-centric technique for implementing business logic
and persisting aggregates. An aggregate is stored in the database as a series
of events. Each event represents a state change of the aggregate. 
An aggregate’s business logic is structured around the requirement to 
produce and consume these events.


## Troubles with traditional persistence

![img_133.png](img_133.png)

### Object-Relational Impedance Mismatch

![img_134.png](img_134.png)

### Lack of Aggregate history

![img_135.png](img_135.png)

### Implementing audit logging is tedious and error prone

![img_136.png](img_136.png)

### Event publishing is bolted on to the business logic

![img_137.png](img_137.png)

## Event Sourcing

![img_138.png](img_138.png)

Command method is a sequence of events that represent the state changes that must be
made. These events are persisted in the database and applied to the aggregate to
update its state

Event sourcing refactors a command method into
two or more methods. The first method takes a command object parameter, which
represents the request, and determines what state changes need to be performed. It
validates its arguments, and without changing the state of the aggregate, returns a list
of events representing the state changes. This method typically throws an exception if
the command cannot be performed.

The other methods each take a particular event type as a parameter and update
the aggregate. There’s one of these methods for each event. It’s important to note
that these methods can’t fail, because an event represents a state change that has happened. 
Each method updates the aggregate based on the event.


![img_139.png](img_139.png)

